<!DOCTYPE html>
<html lang="en">
<head>
  <title>CS4241 Assignment 2</title>
  <meta charset="utf-8" />
</head>
<body>
<form action="">
  <input type="text" id="bookname" value="name of book here" />
  <input type="text" id="length" value="length of book here" />
  <input type="text" id="author" value="author of book here" />
  <input type="hidden" id="timestamp" name="timestamp" value="0">
  <button id = "submit">submit</button>
</form>
<form action="">
  <input type="text" id="pointer" value="index value to remove">
  <button id = "delete">remove record</button>
</form>
</body>
<script>
  const submit = function(e) {
    // prevent default form action from being carried out
    e.preventDefault();


    const inputname = document.querySelector("#bookname"),
            inputlength = document.querySelector("#length"),
            inputauthor = document.querySelector("#author"),
            letime = Date.now()
    retime = letime.value + 604800*3;
    const json = {
              bookname: inputname.value, length: inputlength.value, author: inputauthor.value, checktime: letime.value,
              returntime: retime.value
            },
            body = JSON.stringify(json);

    fetch("/submit", {
      method: "POST",
      body
    }).then(function(response) {
      return response.json();
    })
            .then(function(json) {
              console.log(json);
            });

    return false;
  };

  const delRecord = function(e){
    e.preventDefault();
    const body = JSON.stringify({'index' : +document.querySelector("#pointer")});

    fetch("/delete", {
      method: "POST",
      body
    }).then(function(response) {
      return response.json();
    })
            .then(function(json) {
              console.log(json);
            });

    return false;
  }

  window.onload = function() {
    const submitButton = document.querySelector("#submit");
    const deleteButton = document.querySelector("#delete");
    submitButton.onclick = submit;
    deleteButton.onclick = delRecord;
  };
</script>
</html>